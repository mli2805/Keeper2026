<Window x:Class="KeeperWpf.CarsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:keeperWpf="clr-namespace:KeeperWpf"
        mc:Ignorable="d" d:DataContext="{d:DesignInstance keeperWpf:CarsViewModel}"
        Width="754"  Height="650" WindowStartupLocation="CenterScreen">
    <DockPanel Margin="5">
        <ListView DockPanel.Dock="Top" ItemsSource="{Binding Cars}" SelectedItem="{Binding SelectedCar, Mode=TwoWay}" 
                  Margin="5" SelectionMode="Single">
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Setter Property="BorderBrush" Value="LightGray" />
                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Машина" DisplayMemberBinding="{Binding Title}" Width="190"/>
                    <GridViewColumn Header="г.в." DisplayMemberBinding="{Binding IssueYear}" Width="40"/>
                    <GridViewColumn Header="покупка" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding PurchaseDate, StringFormat='{}{0:d/MM/yyyy}'}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}" />
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="до" Width="60">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding PurchaseMileage}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="продажа" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding SaleDate, StringFormat='{}{0:d/MM/yyyy}'}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="после" Width="60">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding SaleMileage}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="пробег" Width="60">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding MileageDifference}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="в день" Width="60">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding MileageAday}" TextAlignment="Right"
                                           d:DataContext="{d:DesignInstance keeperWpf:CarModel}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
        <Border BorderBrush="Gray" BorderThickness="1" Margin="5">
            <DockPanel DockPanel.Dock="Left" >
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                    <TextBlock Text="{Binding SelectedCar.Title}" 
                               HorizontalAlignment="Left" Margin="5" Width="200"/>
                    <StackPanel  Orientation="Horizontal">
                        <TextBlock Text="VIN:" Margin="20,5,5,5" Width="20"/>
                        <TextBox IsReadOnly="true" BorderThickness="0" 
                                 Text="{Binding SelectedCar.Vin}" Margin="5" Width="120"/>
                    </StackPanel>
                    <StackPanel  Orientation="Horizontal">
                        <TextBlock Text="Номер:" Margin="20,5,5,5" Width="40"/>
                        <TextBlock Text="{Binding SelectedCar.StateRegNumber}" Margin="5" Width="80"/>
                    </StackPanel>
                </StackPanel>

                <DataGrid DockPanel.Dock="Top" ItemsSource="{Binding YearMileagesToShow}" 
                          Margin="5,0,5,5"  AutoGenerateColumns="False"
                          HorizontalGridLinesBrush="LightGray" VerticalGridLinesBrush="LavenderBlush" >
                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="ContentTemplate">
                                <Setter.Value>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" 
                                                   TextWrapping="Wrap" 
                                                   TextAlignment="Center"
                                                   Padding="0"/>
                                    </DataTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="#" Width="30" Binding="{Binding YearNumber}"/>
                        <DataGridTextColumn Header="год" Width="150" Binding="{Binding FromTo}"/>
                        <DataGridTextColumn Header="пробег за год" Width="60" Binding="{Binding Mileage}"/>
                        <DataGridTextColumn Header="одометр" Width="60" Binding="{Binding Odometer}"/>
                        <DataGridTextColumn Header="$ сумма за год" Width="60" 
                                            Binding="{Binding YearAmount, StringFormat={}{0:# ###.0}}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="Padding" Value="0,0,5,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="$ сумма в день" Width="60" Binding="{Binding DayAmount, StringFormat=N1}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="Padding" Value="0,0,5,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
                <TextBlock DockPanel.Dock="Top"  Margin="5" Text="* суммы по годам без учета покупки-продажи"></TextBlock>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,5" Visibility="{Binding IsLastCarVisibility}">
                    <TextBlock Text="Текущий пробег" Margin="5,0,5,3" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding SelectedCar.SaleMileage}" Width="70" VerticalAlignment="Center"/>
                    <TextBlock Text="км. " Margin="5,0,5,3" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,5" Visibility="{Binding IsLastCarVisibility}">
                    <TextBlock Text="Предполагаемая продажа " Margin="5,0,5,3" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding SelectedCar.SupposedSalePrice}" Width="70" VerticalAlignment="Center"/>
                    <TextBlock Text="usd" Margin="5,0,5,3" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5">
                    <TextBlock Text="Итого:"/>
                    <TextBlock Margin="10,0,0,0" Text="{Binding Total.FromTo}"/>
                    <TextBlock Margin="15,0, 2,0" Text="{Binding Total.Mileage, StringFormat={}{0:# ###}}"/>
                    <TextBlock Text="км"/>
                    <TextBlock Margin="15,0, 2, 0" Text="{Binding Total.YearAmount, StringFormat={}{0:# ###}}"/>
                    <TextBlock Text="$"/>
                    <TextBlock Margin="15,0, 2, 0" Text="{Binding Total.DayAmount, StringFormat=N1}"/>
                    <TextBlock Text="$ в день"/>
                </StackPanel> 
                <StackPanel Orientation="Horizontal" Margin="5">
                    <TextBlock Text="С учетом покупки-продажи:"/>
                    <TextBlock Margin="105,0, 2, 0" 
                               Text="{Binding TotalPlus.YearAmount, StringFormat={}{0:# ###}}"/>
                    <TextBlock Text="$"/>
                    <TextBlock Margin="15,0, 2, 0" 
                               Text="{Binding TotalPlus.DayAmount, StringFormat=N1}"/>
                    <TextBlock Text="$ в день"/>
                </StackPanel>


                <DockPanel Margin="5">
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                        <TextBlock Text="" Margin="5" Width="40"/>
                        <TextBlock Text="{Binding SelectedCar.Comment}" Height="40" TextWrapping="Wrap" Margin="5"/>
                    </StackPanel>
                    <StackPanel></StackPanel>
                </DockPanel>
            </DockPanel>
        </Border>

        <Button DockPanel.Dock="Bottom" Content="Закрыть" Width="120" Margin=" 5" Name="CloseView" HorizontalAlignment="Right"/>
        <Button Name="ShowOwnershipCostChart" 
                DockPanel.Dock="Bottom" Height="48" Width="120" Margin="5" HorizontalAlignment="Right" >
            <TextBlock TextWrapping="Wrap" Text="График стоимости владения" TextAlignment="Center"/>
        </Button>
        <StackPanel DockPanel.Dock="Bottom" Orientation="Vertical" Margin="5,5,5,50" HorizontalAlignment="Right">
            <CheckBox IsChecked="{Binding IsByTags}" Margin="5" Width="120">
                <TextBlock Text="Ремонты по категориям" TextWrapping="Wrap"/>
            </CheckBox>
            <CheckBox IsChecked="{Binding IsBynInReport}" Margin="5" Width="120">
                <TextBlock Text="Показывать суммы в рублях" TextWrapping="Wrap"/>
            </CheckBox>
            <Button Content="Авто отчет" Width="120" Margin="0,5" Name="ShowCarReport" />
        </StackPanel>
        <StackPanel Margin="5,20" HorizontalAlignment="Right">
            <Button Content="Заправка" Width="120" Margin="5" Name="Fuelling"/>
        </StackPanel>
    </DockPanel>
</Window>
