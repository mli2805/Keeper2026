<Window x:Class="KeeperWpf.TransactionsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:keeperWpf="clr-namespace:KeeperWpf"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:cal="http://www.caliburnproject.org"
        mc:Ignorable="d" 
        Height="800" Width="{Binding Width, Mode=TwoWay}" 
        Top="{Binding Top, Mode=TwoWay}" Left="{Binding Left, Mode=TwoWay}"
        TextOptions.TextFormattingMode="Display" d:DataContext="{d:DesignData TransactionsViewModel}">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="PreviewKeyDown">
            <cal:ActionMessage MethodName="OnPreviewKeyDown">
                <cal:Parameter Value="$eventArgs" />
            </cal:ActionMessage>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <DockPanel>
        <DockPanel DockPanel.Dock="Bottom" Margin="5">
            <TabPanel>
                <Border BorderThickness="1" BorderBrush="LightSlateGray">
                    <StackPanel Orientation="Horizontal" Margin="4,2">
                        <DatePicker Width="100" Height="24" SelectedDate="{Binding Model.AskedDate}"
                                    VerticalAlignment="Center" BorderBrush="Black"/>
                        <Button Margin="5,0,0,0" Style="{StaticResource MyButtonStyle}" ToolTip="Go"
                                 cal:Message.Attach="[Event Click] = [GoToDate()]">
                            <Image Source="../../Resources/misc/goto.png" Width="16" Height="16"  Margin="2,0"/>
                        </Button>
                    </StackPanel>
                </Border>
            </TabPanel>

            <Button Height="24" Margin="5,0,0,0" ToolTip="Go to the end"
                    Style="{StaticResource MyButtonStyle}"
                    cal:Message.Attach="[Event Click] = [GoToLast()]">
                <Image Source="../../Resources/misc/to_end.png" Width="16" Height="16" Margin="2,0"/>
            </Button>

            <Button Name="ButtonFilter" Margin="100,0,0,0" ToolTip="Filter"
                    Style="{StaticResource MyButtonStyle}">
                <Image Source="../../Resources/misc/filter.png" Width="26" Height="24" Margin="2,0" />
            </Button>
            <Button Name="Calculator" Margin="15,0,15,0" ToolTip="Calculator"
                    Style="{StaticResource MyButtonStyle}">
                <Image Source="../../Resources/mainmenu/calculator.png" Width="24" Height="24" Margin="2,0" />
            </Button>

            <Button Height="25" Width="100" HorizontalAlignment="Right" Margin="0,0,5,0"
                    Style="{StaticResource MyButtonStyle}"
                    Content="Close" IsCancel="True" />
        </DockPanel>
        <DataGrid Name="MainDataGrid" ItemsSource="{Binding Model.Rows}" 
                  SelectedItem="{Binding Model.SelectedTranWrappedForDataGrid, Mode=TwoWay}"
                  cal:Message.Attach="[Event MouseDoubleClick] = [Action ActionsMethod(1)]"
                  IsReadOnly="True" AutoGenerateColumns="False" SelectionMode="Single" 
                  SelectionChanged="OnSelectionChanged" Loaded="MainDataGrid_Loaded">
            <i:Interaction.Behaviors>
                <keeperWpf:ScrollToBottomOnAddBehavior />
                <keeperWpf:ScrollToBottomOnLoadBehavior />
            </i:Interaction.Behaviors>
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Изменить (Space)" cal:Message.Attach="[Event Click] = [Action ActionsMethod(1)]"
                              BorderBrush="{x:Null}" Background="White" />
                    <MenuItem Header="Сдвинуть вверх (Ctrl+NumPad8)"
                              cal:Message.Attach="[Event Click] = [Action ActionsMethod(2)]"
                              BorderBrush="{x:Null}" Background="White" />
                    <MenuItem Header="Сдвинуть вниз (Ctrl+NumPad2)"
                              cal:Message.Attach="[Event Click] = [Action ActionsMethod(3)]"
                              BorderBrush="{x:Null}" Background="White" />
                    <MenuItem Header="Вставить после (Insert)"
                              cal:Message.Attach="[Event Click] = [Action ActionsMethod(4)]"
                              BorderBrush="{x:Null}" Background="White" />
                    <MenuItem Header="Удалить (Ctrl+Del)"
                              cal:Message.Attach="[Event Click] = [Action ActionsMethod(5)]"
                              BorderBrush="{x:Null}" Background="White" />
                </ContextMenu>
            </DataGrid.ContextMenu>
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Foreground" Value="{Binding TransactionFontColor}" />
                            <Setter Property="BorderThickness" Value="0" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>
            <DataGrid.ItemContainerStyle>
                <Style TargetType="{x:Type DataGridRow}">
                    <Setter Property="Background" Value="{Binding DayBackgroundColor}" />
                    <Setter Property="Foreground" Value="{Binding TransactionFontColor}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#B6E6FF" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.ItemContainerStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header=" Когда" Width="100"
                                    Binding="{Binding Tran.Timestamp, StringFormat='dd-MM-yyyy HH:mm'}" />
                <DataGridTextColumn Header="R" Width="10" Binding="{Binding Tran.Receipt}" />
                <DataGridTextColumn Header="  Мой счет" Width="350*" Binding="{Binding AccountForDataGrid}" />
                <DataGridTextColumn Header="  Контрагент" Width="175*" Binding="{Binding Tran.Counterparty}" />
                <DataGridTextColumn Header="способ опл." Width="85" Binding="{Binding PaymentWayForDataGrid}" />
                <DataGridTextColumn Header="  Категория" Width="200*" Binding="{Binding Tran.Category}" />
                <DataGridTextColumn Header="  Сколько" Width="120*" Binding="{Binding AmountForDataGrid}" />
                <DataGridTextColumn Header="  Тэги и коммент" Width="300*" Binding="{Binding TagsAndCommentForDataGrid}">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping" Value="Wrap" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>